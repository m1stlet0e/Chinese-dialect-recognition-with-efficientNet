# 方言识别 API - 快速开始

## 一分钟快速启动

### 1. 安装依赖
```bash
cd API
pip3 install flask flask-cors requests
```

### 2. 启动服务
```bash
# 方式1: 使用启动脚本
./start_server.sh

# 方式2: 直接运行
python3 api_server.py
```

### 3. 测试API

**方式A: 使用网页测试**
```bash
# 用浏览器打开
open test_page.html
# 或直接双击 test_page.html 文件
```

**方式B: 使用测试脚本**
```bash
python3 test_client.py your_audio.wav
```

**方式C: 使用 cURL**
```bash
curl -X POST -F "file=@your_audio.wav" http://localhost:5000/api/predict
```

## 主要接口

### 1. 预测音频 (POST /api/predict)

**请求:**
```bash
curl -X POST \
  -F "file=@audio.wav" \
  http://localhost:5000/api/predict
```

**响应:**
```json
{
  "success": true,
  "dialect": "客家话",
  "confidence": 0.8555,
  "all_probabilities": {
    "客家话": 0.8555,
    "长沙话": 0.0937,
    ...
  }
}
```

### 2. 获取支持的方言 (GET /api/dialects)

```bash
curl http://localhost:5000/api/dialects
```

### 3. 健康检查 (GET /api/health)

```bash
curl http://localhost:5000/api/health
```

## Python 调用示例

```python
import requests

# 预测音频文件
with open('audio.wav', 'rb') as f:
    files = {'file': f}
    response = requests.post(
        'http://localhost:5000/api/predict', 
        files=files
    )
    result = response.json()
    
    if result['success']:
        print(f"识别结果: {result['dialect']}")
        print(f"置信度: {result['confidence']:.2%}")
```

## JavaScript 调用示例

```javascript
const formData = new FormData();
formData.append('file', audioFile);

fetch('http://localhost:5000/api/predict', {
  method: 'POST',
  body: formData
})
.then(response => response.json())
.then(data => {
  console.log('识别结果:', data.dialect);
  console.log('置信度:', (data.confidence * 100).toFixed(2) + '%');
});
```

## 生产部署

```bash
# 安装 gunicorn
pip3 install gunicorn

# 启动服务 (4个worker)
gunicorn -w 4 -b 0.0.0.0:5000 api_server:app
```

## 测试文件清单

- `test_page.html` - 网页测试界面 (最简单)
- `test_client.py` - Python测试客户端
- `start_server.sh` - 启动脚本
- `README.md` - 完整API文档

## 常见问题

**Q: 端口被占用?**
```python
# 修改 api_server.py 最后一行
app.run(host='0.0.0.0', port=8000)  # 改成其他端口
```

**Q: 跨域问题?**
```python
# 已默认启用CORS,支持跨域访问
```

**Q: 识别速度慢?**
```bash
# 使用GPU或多进程部署
gunicorn -w 4 api_server:app
```

## 支持的方言

长沙话、河北话、合肥话、客家话、南昌话、宁夏话、陕西话、上海话、四川话

## 下一步

- 查看完整文档: `README.md`
- 集成到你的应用中
- 部署到生产环境

有问题随时查阅 README.md 获取详细信息!


